(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58797118"],{1502:function(t,e,o){o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"page-live"},[o("div",{staticClass:"tab-row",class:{disable:-1===t.activeTab}},[o("div",{staticClass:"cent",class:{active:0===t.activeTab},on:{click:function(e){t.activeTab=0}}},[t._v("实时直播"),o("i",{staticClass:"icon iconfont-cnpsec iconfont-live"})]),o("div",{staticClass:"cent",class:{active:1===t.activeTab},on:{click:function(e){t.activeTab=1}}},[t._v("互动")])]),o("div",{staticClass:"main-container"},[o("keep-alive",[o(t.currentTabComponent,{tag:"component"})],1)],1)])},i=[],r=(o("8e6e"),o("ac6a"),o("cadf"),o("456d"),o("551c"),o("e7e5"),o("d399")),a=o("bd86"),s=o("246a"),c=o("f866"),l=o("310a"),u=o("2f62");function f(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function m(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?f(Object(o),!0).forEach((function(e){Object(a["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var v={data:function(){return{activeTab:0,pageLiveInfo:{}}},computed:m({currentTabComponent:function(){var t=[s["default"],c["default"]];return t[this.activeTab]}},Object(u["c"])(["liveInfo","userInfo"])),activated:function(){var t=this.$route.query;this.pageLiveInfo={brokerId:t.brokerId,topicId:t.topicId},this.getRoomOnlineNumTimer=null,this.getBasicChatInfo()},beforeRouteEnter:function(t,e,o){o((function(t){document.body.addEventListener("touchmove",t.preDev,{passive:!1})}))},beforeRouteLeave:function(t,e,o){document.body.removeEventListener("touchmove",this.preDev,{passive:!1}),o()},deactivated:function(){this.liveInfo.connected&&Object(l["m"])(),this.getRoomOnlineNumTimer&&clearInterval(this.getRoomOnlineNumTimer)},methods:{preDev:function(t){t.preventDefault()},getBasicChatInfo:function(){var t=this;this.$store.commit("SET_ROLLING_MSG",[]),this.$store.commit("SET_YUN_XIN_MSG",[]),Object(l["i"])(this.$route.query.brokerId,this.$route.query.topicId).then((function(e){var o={brokerId:e.broker_id,brokerKey:e.broker_key,brokerAvatar:e.broker_avatar,brokerName:e.broker_name,topicId:e.topic_id,chatTopic:e.topic,roomStatus:e.room_status,gagFlag:e.gag_flag,startTime:e.start_time};"1"===e.room_status&&t.initLiveInfo(e.broker_id),t.$store.commit("SET_LIVE_INFO",o)})).catch((function(){Object(r["a"])("获取直播投顾信息出错")}))},initLiveInfo:function(t){var e=this;this.getBrokerChatRoomInfo(t).then((function(o){var n={gagAllFlag:o.all_gag_flag,yunXinBroadcastUrl:o.yunxin_broadcast_url,yunXinRoomId:o.yunxin_room_id,yunXinAcct:e.userInfo.yunxin_acct,yunXinToken:e.userInfo.yunxin_token};e.$store.commit("SET_LIVE_INFO",n),e.fansClickBroker(t).then((function(){e.getRoomOnlineNum(t),e.getRoomOnlineNumTimer&&clearInterval(e.getRoomOnlineNumTimer),e.getRoomOnlineNumTimer=setInterval((function(){e.getRoomOnlineNum(t)}),6e4)})),Object(l["k"])()})).catch((function(){Object(r["a"])("获取直播间信息出错")}))},getBrokerChatRoomInfo:function(t){var e=this;return new Promise((function(o,n){e.$services.getChatroomInfo({data:{identity:"1",tenant_id:e.userInfo.tenant_id,broker_id:t}}).then((function(t){o(t)})).catch((function(){n()}))}))},fansClickBroker:function(t){var e=this;return new Promise((function(o,n){e.$services.fansClickBroker({data:{broker_id:t,topic_id:e.liveInfo.topicId}}).then((function(t){o(t)})).catch((function(){n()}))}))},getRoomOnlineNum:function(t){var e=this;this.$services.getChatroomOnlinenumByFans({data:{broker_id:t}}).then((function(t){var o={onlineNum:t.online_num};e.$store.commit("SET_LIVE_INFO",o)})).catch((function(){Object(r["a"])("获取直播在线人数失败")}))}}},h=v,d=(o("2ee0"),o("2877")),g=Object(d["a"])(h,n,i,!1,null,"5f9ddd59",null);e["default"]=g.exports},"246a":function(t,e,o){o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"com-realtime"},[o("div",{directives:[{name:"show",rawName:"v-show",value:"1"===t.liveInfo.roomStatus,expression:"liveInfo.roomStatus === '1'"}],staticClass:"topic-info"},[o("div",{staticClass:"cent title"},[t._v("当前话题: "+t._s(t.liveInfo.chatTopic))]),o("div",{directives:[{name:"show",rawName:"v-show",value:t.liveInfo.onlineNum>=100,expression:"liveInfo.onlineNum >= 100"}],staticClass:"cent people"},[o("i",{staticClass:"icon iconfont-cnpsec iconfont-hot"}),t._v(t._s(t.liveInfo.onlineNum)+"人\n    ")])]),o("div",{staticClass:"live-scroll-box"},[o("BsLoadMore",{ref:"pageLoadMore",attrs:{canLoad:t.canLoad},on:{loadMore:t.loadHistory,bsScroll:t.pageScroll}},t._l(t.rollingMsg,(function(e,n){return t.rollingMsg.length?o("div",{key:n,ref:"baseDom",refInFor:!0},[o("MessageCard",{attrs:{message:e}})],1):t._e()})),0)],1),o("div",{staticClass:"risk-tips"},[t._v("\n    【风险提示】以上内容仅供参考，不构成投资建议，亦不作为投资决策依据。股市有风险，入市需谨慎。\n  ")]),o("div",{staticClass:"income-message",class:{active:t.messageCome&&!t.isScrollBottom},on:{click:t.scrollToPageBottom}},[t._v("收到新消息\n  ")])])},i=[],r=(o("8e6e"),o("ac6a"),o("cadf"),o("456d"),o("75fc")),a=(o("e7e5"),o("d399")),s=o("bd86"),c=o("1a60"),l=o("cc64"),u=o("2f62"),f=o("310a");function m(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function v(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?m(Object(o),!0).forEach((function(e){Object(s["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var h={components:{BsLoadMore:c["a"],MessageCard:l["a"]},data:function(){return{interval:null,canLoad:"",showNoData:!1,positionStr:0,requestNum:20,messageCome:!1,isScrollBottom:!0,lastStr:0}},computed:v({},Object(u["c"])(["liveInfo","rollingMsg","rollingMsgCome"])),watch:{rollingMsgCome:function(){this.messageCome=!0}},activated:function(){this.interval=null,this.canLoad="",this.showNoData=!1,this.positionStr=0,this.messageCome=!1,this.isScrollBottom=!0,this.$store.commit("SET_ROLLING_MSG",[]),this.getHistoryRealTimeMsg()},deactivated:function(){clearInterval(this.interval)},methods:{getHistoryRealTimeMsg:function(t,e){var o=this;Object(f["j"])(this.positionStr,this.requestNum).then((function(n){!t&&n.length&&(o.lastStr=n[0].position_str),o.positionStr=n.length&&n[n.length-1].position_str,t?o.fixLoadData(Object(f["b"])(n),t,e):o.fixLoadData(Object(f["b"])(n.reverse()),t,e)})).catch((function(e){a["a"].fail(e),console.log("getHistoryRealTimeMsg"+e),t||(o.canLoad=!1,o.showNoData=!0)}))},fixLoadData:function(t,e,o){var n=this;if(t.length>=this.requestNum?this.canLoad=!0:this.canLoad=!1,e){var i=Object(r["a"])(this.rollingMsg);t.map((function(t){i.unshift(t)})),this.$store.commit("SET_ROLLING_MSG",i),this.$nextTick((function(){var e=n.fixLoadDataHeight(t.length);"function"===typeof o&&o(e)}))}else this.$store.commit("SET_ROLLING_MSG",t),t.length?setTimeout((function(){n.$refs.pageLoadMore.scrollBottom()}),300):this.showNoData=!0;this.interval||(this.interval=setInterval(this.getNewRollingMsg,6e4))},fixLoadDataHeight:function(t){for(var e=0,o=0;o<t;o++)e+=this.$refs.baseDom[o].clientHeight;return e},loadHistory:function(t){this.getHistoryRealTimeMsg("append",t)},pageScroll:function(t,e){t<e?this.isScrollBottom=!1:(this.isScrollBottom=!0,this.messageCome=!1)},scrollToPageBottom:function(){this.$refs.pageLoadMore.scrollBottom(),this.messageCome=!1},getNewRollingMsg:function(){var t=this;Object(f["j"])(this.lastStr,50,1).then((function(e){if(e.length){t.lastStr=e[0].position_str;var o=Object(f["b"])(e.reverse()),n=Object(r["a"])(t.rollingMsg);t.$store.commit("SET_ROLLING_MSG",n.concat(o));var i=t.rollingMsgCome+1;t.$store.commit("SET_ROLLING_MSG_COME",i)}})).catch((function(t){console.log("查询最新")}))}}},d=h,g=(o("b442"),o("2877")),b=Object(g["a"])(d,n,i,!1,null,"27c5be44",null);e["default"]=b.exports},"2ee0":function(t,e,o){var n=o("303d"),i=o.n(n);i.a},"303d":function(t,e,o){},"7fa6":function(t,e,o){},b442:function(t,e,o){var n=o("7fa6"),i=o.n(n);i.a}}]);