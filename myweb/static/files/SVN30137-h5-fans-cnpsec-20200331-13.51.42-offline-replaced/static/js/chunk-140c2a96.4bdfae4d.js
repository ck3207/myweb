(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-140c2a96"],{"0d2b":function(t,e,i){var o=i("c6b2"),s=i.n(o);s.a},"20fd":function(t,e,i){var o=i("d9f6"),s=i("aebd");t.exports=function(t,e,i){e in t?o.f(t,e,s(0,i)):t[e]=i}},"3d2c":function(t,e,i){var o=i("cb73"),s=i.n(o);s.a},"549b":function(t,e,i){var o=i("d864"),s=i("63b6"),n=i("241e"),a=i("b0dc"),c=i("3702"),r=i("b447"),l=i("20fd"),u=i("7cd6");s(s.S+s.F*!i("4ee1")((function(t){Array.from(t)})),"Array",{from:function(t){var e,i,s,h,f=n(t),p="function"==typeof this?this:Array,m=arguments.length,g=m>1?arguments[1]:void 0,d=void 0!==g,v=0,b=u(f);if(d&&(g=o(g,m>2?arguments[2]:void 0,2)),void 0==b||p==Array&&c(b))for(e=r(f.length),i=new p(e);e>v;v++)l(i,v,d?g(f[v],v):f[v]);else for(h=b.call(f),i=new p;!(s=h.next()).done;v++)l(i,v,d?a(h,g,[s.value,v],!0):s.value);return i.length=v,i}})},"75fc":function(t,e,i){var o=i("a745"),s=i.n(o);function n(t){if(s()(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}var a=i("774e"),c=i.n(a),r=i("c8bb"),l=i.n(r);function u(t){if(l()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return c()(t)}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(t){return n(t)||u(t)||h()}i.d(e,"a",(function(){return f}))},"774e":function(t,e,i){t.exports=i("d2d5")},ac58:function(t,e,i){var o=i("da2b"),s=i.n(o);s.a},c6b2:function(t,e,i){},cb73:function(t,e,i){},d2d5:function(t,e,i){i("1654"),i("549b"),t.exports=i("584a").Array.from},da2b:function(t,e,i){},f6ab:function(t,e,i){t.exports=i.p+"static/img/bg_no_data.93c56ab0.png"},f866:function(t,e,i){i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"interactiveDom",staticClass:"com-interactive"},[i("div",[i("div",{staticClass:"topic-info"},[i("div",{staticClass:"cent title"},[t._v("当前话题: "+t._s(t.liveInfo.chatTopic))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.liveInfo.onlineNum>=100,expression:"liveInfo.onlineNum >= 100"}],staticClass:"cent people"},[i("i",{staticClass:"icon iconfont-cnpsec iconfont-hot"}),t._v(t._s(t.liveInfo.onlineNum)+"人\n      ")])]),i("div",{staticClass:"live-scroll-box",on:{click:t.pageClick}},[i("BsLoadMore",{ref:"pageLoadMore",attrs:{canLoad:t.canLoad,bottomHeight:80},on:{loadMore:t.loadHistory}},t._l(t.yunXinMsg,(function(e,o){return t.yunXinMsg.length?i("div",{key:o,ref:"baseDom",refInFor:!0},[i("MessageBubble",{attrs:{message:e}})],1):t._e()})),0)],1),i("div",{staticClass:"operate-box",class:{"operate-disable":"0"===t.liveInfo.gagAllFlag||"0"===t.liveInfo.gagFlag}},[i("div",{ref:"inputDom",staticClass:"top-box"},[i("div",{staticClass:"left"},[i("i",{staticClass:"icon iconfont-cnpsec iconfont-dollar",on:{click:t.clickSearch}}),i("i",{staticClass:"icon iconfont-cnpsec iconfont-emoji",on:{click:t.clickEmojiBox}}),i("van-uploader",{attrs:{"before-read":t.beforeRead,"after-read":t.afterRead,"preview-image":!1}},[i("i",{staticClass:"icon iconfont-cnpsec iconfont-picture"})])],1),i("div",{staticClass:"center"},[i("pre",{ref:"pre",staticClass:"pre"},[t._v("预设内容")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputValue,expression:"inputValue"}],ref:"textAreaDom",staticClass:"user-input",attrs:{rows:"1","data-index":"0",placeholder:"0"===t.liveInfo.gagAllFlag?"已全员禁言":"0"===t.liveInfo.gagFlag?"您已被禁言":""},domProps:{value:t.inputValue},on:{focus:t.focus,blur:t.blur,input:function(e){e.target.composing||(t.inputValue=e.target.value)}}})]),i("div",{staticClass:"right",class:{disable:!t.inputValue.length},on:{click:t.sendMessage}},[t._v("发送")])]),i("div",{ref:"emojiBoxDom",staticClass:"bottom-box",class:{show:t.showEmojiBox}},[i("EmojiBox",{on:{"emoji-input":t.getEmojiText}})],1)])]),i("XPopup",{staticClass:"search-box",attrs:{show:t.showSearchStock}},[i("div",{staticClass:"stock-search"},[i("div",{staticClass:"search-bar"},[i("div",{staticClass:"search-bar-box"},[i("i",{staticClass:"icon iconfont-cnpsec iconfont-search"}),i("input",{directives:[{name:"model",rawName:"v-model",value:t.stockSearchValue,expression:"stockSearchValue"}],ref:"input",staticClass:"search-bar-input",attrs:{type:"search",placeholder:"请输入股票代码"},domProps:{value:t.stockSearchValue},on:{input:function(e){e.target.composing||(t.stockSearchValue=e.target.value)}}})]),i("div",{staticClass:"btn-cancel",on:{click:t.cancelStockSearch}},[t._v("取消")])]),i("div",{staticClass:"list"},t._l(t.stockList,(function(e,o){return i("div",{key:o,staticClass:"cell-item",on:{click:function(i){return t.choseStock(e.chi_name,e.stock_code)}}},[i("div",{staticClass:"cent"},[t._v(t._s(e.chi_name))]),i("div",{staticClass:"cent right"},[t._v(t._s(e.stock_code))])])})),0)])])],1)},s=[],n=(i("8e6e"),i("cadf"),i("456d"),i("ac6a"),i("75fc")),a=i("bd86"),c=i("e8b7"),r=i("1a60"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"com-emoji-box"},[i("van-swipe",{staticClass:"main-box",attrs:{loop:!1,autoplay:0,"indicator-color":"rgba(0, 0, 0, 0.4)"}},t._l(t.emojiText,(function(e,o){return i("van-swipe-item",{key:o},t._l(e,(function(e,s){return i("i",{key:s,staticClass:"face",class:"face-"+(o+1)+" icon-"+s,on:{click:function(i){return i.stopPropagation(),i.preventDefault(),t.tapEmoji(e[0],i)}}})})),0)})),1)],1)},u=[],h={name:"EmojiBox",data:function(){return{emojiText:"",value:0}},computed:{},beforeMount:function(){},mounted:function(){this.emojiText=[[["大笑"],["汗"],["可爱"],["色"],["嘘"],["亲"],["呆"],["口水"],["呲牙"],["鬼脸"],["害羞"],["偷笑"],["调皮"],["可怜"],["敲"],["惊讶"],["流感"],["委屈"],["流泪"],["嚎哭"],["惊恐"]],[["怒"],["酷"],["不说"],["鄙视"],["阿弥陀佛"],["奸笑"],["睡着"],["口罩"],["努力"],["拜一拜"],["惊喜"],["流汗"],["卖萌"],["抠鼻孔"],["疑问"],["怒骂"],["晕"],["呕吐"],["默契眨眼"],["烧香拜佛"],["晚安"]],[["握手"],["强"],["弱"],["OK"],["拳头"],["胜利"],["鼓掌"],["发怒"],["骷髅"],["便便"],["火"],["溜"],["爱心"],["心碎"],["钟情"],["唇"],["戒指"],["钻石"],["太阳"],["有时晴"],["多云"]],[["雷"],["雨"],["雪花"],["爱人"],["帽子"],["皇冠"],["篮球"],["足球"],["垒球"],["网球"],["台球"],["咖啡"],["啤酒"],["干杯"],["柠檬汁"],["餐具"],["汉堡"],["鸡腿"],["面条"],["冰淇淋"],["沙冰"]],[["生日蛋糕"],["蛋糕"],["糖果"],["葡萄"],["西瓜"],["光碟"],["手机"],["电话"],["电视"],["声音开启"],["声音关闭"],["铃铛"],["锁头"],["放大镜"],["灯泡"],["锤头"],["烟"],["炸弹"],["枪"],["刀"],["药"]],[["钞票"],["银行卡"],["手柄"],["麻将"],["调色板"],["电影"],["麦克风"],["打针"],["钱袋"],["耳机"],["音乐"],["吉他"],["火箭"],["飞机"],["火车"],["公交"],["轿车"],["出租车"],["警车"],["自行车"]]]},methods:{tapEmoji:function(t,e){this.$emit("emoji-input","["+t+"]")},nextFunction:function(){return!(this.value>4)},previousFunction:function(){return!(this.value<1)}},components:{}},f=h,p=(i("3d2c"),i("2877")),m=Object(p["a"])(f,l,u,!1,null,"451b51bc",null),g=m.exports,d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide-fade"}},[i("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}],staticClass:"popup-content",class:{"show-pop":t.show},attrs:{"data-transfer":!0},on:{click:t.clickPop}},[t._t("default")],2)])},v=[],b={name:"XPopup",props:{show:{type:Boolean,default:!1}},methods:{clickPop:function(){this.$emit("clickPop")}},directives:{}},k=b,x=(i("0d2b"),Object(p["a"])(k,d,v,!1,null,"0f2a37ce",null)),S=x.exports,j=i("501e"),w=i("d257"),y=i("2f62"),_=i("310a"),D=i("b4f6");function C(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function B(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?C(Object(i),!0).forEach((function(e){Object(a["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var O={components:{MessageBubble:c["a"],EmojiBox:g,XPopup:S,BsLoadMore:r["a"],NoData:j["a"]},data:function(){return{canLoad:"",showSearchStock:!1,showEmojiBox:!1,inputValue:"",stockSearchValue:"",bottomChangeHeight:0,stockList:[],baseInputDomHeight:0,lastSize:0,pageNum:1,pageSize:20,isScrollBottom:!0,imgFile:[]}},computed:B({},Object(y["c"])(["liveInfo","yunXinMsg","userInfo","stuToken"])),watch:{liveInfo:{handler:function(t){"0"!==t.gagAllFlag&&"0"!==t.gagFlag||(this.showEmojiBox=!1,this.cancelStockSearch(),this.inputValue="",this.$refs.textAreaDom.blur())},deep:!0},bottomChangeHeight:function(t){var e=this,i=this.$refs.pageLoadMore.getScroll().y;this.$nextTick((function(){e.$refs.pageLoadMore.getBsDom().style.transform="translateY("+-(Math.abs(i)+t)+"px)",e.$refs.pageLoadMore.getScroll().refresh()}))},showEmojiBox:function(t){this.bottomChangeHeight=t?140+this.$refs.inputDom.clientHeight-this.baseInputDomHeight:this.$refs.inputDom.clientHeight-this.baseInputDomHeight},inputValue:function(t){this.$refs.pre.innerHTML=t,this.showEmojiBox?this.bottomChangeHeight=140+this.$refs.inputDom.clientHeight-this.baseInputDomHeight:this.bottomChangeHeight=this.$refs.inputDom.clientHeight-this.baseInputDomHeight},stockSearchValue:function(t){t?this.inputHandler():this.stockList=[]}},mounted:function(){var t=this;Object(w["l"])((function(){t.$store.dispatch("getDataFromNative")}))},activated:function(){this.inputHandler=Object(w["d"])((function(){this.searchStock()}),500),this.baseInputDomHeight=this.$refs.inputDom.clientHeight,this.initData(),this.getYunXinMsgHistory()},methods:{initData:function(){this.canLoad="",this.showSearchStock=!1,this.showEmojiBox=!1,this.inputValue="",this.stockSearchValue="",this.bottomChangeHeight=0,this.stockList=[],this.lastSize=0,this.pageNum=1,this.pageSize=20,this.isScrollBottom=!0,this.$store.commit("SET_YUN_XIN_MSG",[])},getYunXinMsgHistory:function(t,e){var i=this;Object(_["l"])(this.pageNum,this.pageSize).then((function(o){var s=o.result,n=o.totalNum;i.lastSize+=s.length,t?i.fixLoadData(Object(_["a"])(s),t,n,e):i.fixLoadData(Object(_["a"])(s.reverse()),t,n,e)})).catch((function(e){console.log("getYunXinMsgHistory"+e),t||(i.canLoad=!1,i.showNoData=!0)}))},fixLoadData:function(t,e,i,o){var s=this;if(this.lastSize>=i?this.canLoad=!1:this.canLoad=!0,e){var a=Object(n["a"])(this.yunXinMsg);t.forEach((function(t){a.unshift(t)})),this.$store.commit("SET_YUN_XIN_MSG",a),this.$nextTick((function(){var e=s.fixLoadDataHeight(t.length);"function"===typeof o&&o(e)}))}else this.$store.commit("SET_YUN_XIN_MSG",t),t.length?setTimeout((function(){s.scrollToPageBottom()}),300):this.showNoData=!0},fixLoadDataHeight:function(t){for(var e=0,i=0;i<t;i++)e+=this.$refs.baseDom[i].clientHeight;return e},loadHistory:function(t){this.pageNum++,this.getYunXinMsgHistory("append",t)},pageClick:function(){this.showEmojiBox=!1,this.$refs.textAreaDom.blur()},scrollToPageBottom:function(){this.$refs.pageLoadMore.scrollBottom()},focus:function(){this.$refs.textAreaDom.scrollIntoView(!1),this.scrollToPageBottom()},blur:function(){},clickEmojiBox:function(){this.scrollToPageBottom(),this.showEmojiBox=!this.showEmojiBox},getEmojiText:function(t){this.inputValue=this.inputValue+t},clickSearch:function(){this.scrollToPageBottom(),this.showSearchStock=!this.showSearchStock,this.showEmojiBox=!1},cancelStockSearch:function(){this.showSearchStock=!1,this.stockSearchValue="",this.stockList=[]},searchStock:function(){var t=this,e={stock_code:this.stockSearchValue,request_num:30};this.$services.funcStockList({data:e}).then((function(e){t.stockList=e.data_list}))},choseStock:function(t,e){this.inputValue=this.inputValue+Object(w["n"])(t,e),this.cancelStockSearch()},beforeRead:function(t){var e=["image/jpeg","image/jpg","image/webp","image/png","image/gif"];return-1===e.indexOf(t.type)?(this.$toast("上传图片格式不正确"),!1):!(t.size>2097152)||(this.$toast("上传图片大小不能大于 2M"),!1)},afterRead:function(t){var e=this,i=new FormData;i.append("file",t.file),i.append("customer_id",this.userInfo.customer_id),i.append("type","img"),i.append("sysno","1"),i.append("user_token",this.stuToken),Object(D["b"])(i).then((function(t){var i={ossid:t.oss_id,format:t.format,size:t.size,link:t.oss_prefix+t.oss_id};e.imgFile.push(i),console.log("this.imgFile",e.imgFile),e.sendMessage()})).catch((function(t){e.$toast(t),console.log("uploadFile err",t)}))},sendMessage:function(){var t=this;if(console.log("sendMessage"),this.inputValue||this.imgFile.length){var e=[];this.inputValue&&e.push({type:"text",body:this.inputValue,shareTime:parseInt((new Date).getTime()/1e3,10)}),Array.isArray(this.imgFile)&&this.imgFile.length&&e.push({type:"img",body:this.imgFile,shareTime:parseInt((new Date).getTime()/1e3,10)}),Object(_["n"])(e).then((function(){t.showEmojiBox=!1,t.cancelStockSearch(),t.inputValue="",t.imgFile=[],t.$refs.textAreaDom.focus(),t.scrollToPageBottom(),setTimeout((function(){t.scrollToPageBottom()}),300)})).catch((function(e){console.log("errorInfo",e),t.$toast(e),t.showEmojiBox=!1,t.cancelStockSearch(),t.inputValue="",t.imgFile=[],t.$refs.textAreaDom.focus(),t.scrollToPageBottom(),setTimeout((function(){t.scrollToPageBottom()}),300)}))}else this.$toast("请输入要发送的信息")}}},$=O,E=(i("ac58"),Object(p["a"])($,o,s,!1,null,"38196dc6",null));e["default"]=E.exports}}]);